{% extends 'base.html.twig' %}

{% block title %}Panel de Control - Admin{% endblock %}
{% block stylesheets %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">
{% endblock %}

{% block body %}
<header class=" text-center">
{% if app.session.get('nombre') is not null %}
    <div class="dropdown position-fixed top-0 end-0 m-3">
        <button class="btn btn-light dropdown-toggle d-flex align-items-center" type="button" data-bs-toggle="dropdown">
            <img src="{{ asset('img/pefil.png') }}" alt="Perfil" width="32" height="32" class="rounded-circle me-2">
            {{ app.session.get('nombre')|escape('html') }}
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item text-danger" href="{{ path('app_logout') }}">Cerrar sesión</a></li>
        </ul>
    </div>
{% endif %}
</header>
<div class="container my-5">
  <h1 class="text-center mb-4"><img src="{{ asset('img/paneladmin.png') }}" alt="Admin" style="height:45px;vertical-align:middle;margin-right:7px;">Panel de Control del Administrador</h1>

  <div class="d-flex justify-content-center gap-3 mb-5 flex-wrap">
    <a href="{{ path('admin_crear_ejercicio') }}" class="btn btn-dark"><img src="{{ asset('img/crear1.png') }}" alt="Crear" style="height:26px;vertical-align:middle;margin-right:7px;">Crear Ejercicio</a>
    <a href="{{ path('admin_crear_dieta') }}" class="btn btn-dark"><img src="{{ asset('img/crear1.png') }}" alt="Crear" style="height:26px;vertical-align:middle;margin-right:7px;">Crear Dieta</a>
    <a href="{{ path('admin_crear_rutina') }}" class="btn btn-dark"><img src="{{ asset('img/crear1.png') }}" alt="Crear" style="height:26px;vertical-align:middle;margin-right:7px;">Crear Rutina</a>
    <a href="{{ path('admin_ver_ejercicios') }}" class="btn btn-info"><img src="{{ asset('img/veradmin.png') }}" alt="Ver" style="height:26px;vertical-align:middle;margin-right:7px;">Ver Ejercicios</a>
    <a href="{{ path('admin_ver_rutinas') }}" class="btn btn-info"><img src="{{ asset('img/veradmin.png') }}" alt="Ver" style="height:26px;vertical-align:middle;margin-right:7px;">Ver Rutinas</a>
    <a href="{{ path('admin_ver_dietas') }}" class="btn btn-info"><img src="{{ asset('img/veradmin.png') }}" alt="Ver" style="height:26px;vertical-align:middle;margin-right:7px;">Ver Dietas</a>
  </div>

  <div class="row text-center">
    <div class="col-md-3 mb-3"><div class="card p-3 shadow-sm"><h5><img src="{{ asset('img/pefil.png') }}" alt="User" style="height:26px;vertical-align:middle;margin-right:7px;">Total Usuarios</h5><p class="display-6">{{ totalUsuarios }}</p></div></div>
    <div class="col-md-3 mb-3"><div class="card p-3 shadow-sm"><h5><img src="{{ asset('img/veradmin.png') }}" alt="Rutinas" style="height:26px;vertical-align:middle;margin-right:7px;">Total Rutinas</h5><p class="display-6">{{ totalRutinas }}</p></div></div>
    <div class="col-md-3 mb-3"><div class="card p-3 shadow-sm"><h5><img src="{{ asset('img/fuerza.png') }}" alt="Ejercicios" style="height:26px;vertical-align:middle;margin-right:7px;"> Total Ejercicios</h5><p class="display-6">{{ totalEjercicios }}</p></div></div>
    <div class="col-md-3 mb-3"><div class="card p-3 shadow-sm"><h5><img src="{{ asset('img/calendario.png') }}" alt="Calendario" style="height:26px;vertical-align:middle;margin-right:7px;">Entradas en Calendario</h5><p class="display-6">{{ totalRegistrosCalendario }}</p></div></div>
  </div>

  <div class="row text-center mt-4">
    <div class="col-md-3 mb-3"><div class="card p-3 shadow-sm"><h5>✅ Activos Esta Semana</h5><p class="display-6">{{ usuariosActivosCount }}</p></div></div>
    <div class="col-md-3 mb-3"><div class="card p-3 shadow-sm"><h5><img src="{{ asset('img/promedio2.png') }}" alt="Promedio" style="height:30px;vertical-align:middle;margin-right:7px;">Promedio Entrenamientos</h5><p class="display-6">{{ promedioEntrenamientos }}</p></div></div>
    <div class="col-md-3 mb-3"><div class="card p-3 shadow-sm"><h5>⭐ Valoración Promedio</h5><p class="display-6">{{ mediaOpiniones }} / 10</p></div></div>
    <div class="col-md-3 mb-3"><div class="card p-3 shadow-sm"><h5><img src="{{ asset('img/inactivo.png') }}" alt="Inactivo" style="height:30px;vertical-align:middle;margin-right:7px;"> Inactivos (14 días)</h5><p class="display-6">{{ usuariosInactivosCount }}</p></div></div>
  </div>

    <div class="mt-5">
    <h3 class="text-center mb-4">
        <img src="{{ asset('img/valoracion_pagina.png') }}" alt="Comentarios" style="height:48px;vertical-align:middle;margin-right:7px;">
        Opiniones de usuarios
    </h3>
    <div class="list-group" id="opiniones-lista">
        {% for op in opiniones|slice(0,3) %}
        <div class="list-group-item">
            <h6>{{ op['nombre']|default('Usuario')|e }}
            <small class="text-muted">
                ({{ op['fecha'] is defined ? op['fecha'].toDateTime().format('d/m/Y') : '' }})
            </small>
            </h6>
            <p class="mb-1">
            <img src="{{ asset('img/promedio2.png') }}" alt="Valoraciones" style="height:26px;vertical-align:middle;margin-right:7px;">
            Valoración: <strong>{{ op['puntuacion']|default('-') }}/10</strong><br>
            {{ op['comentario']|default('')|e }}
            </p>
        </div>
        {% endfor %}
        {% if opiniones|length > 3 %}
        <div id="opiniones-extra" style="display:none; transition: all 0.3s;">
            {% for op in opiniones|slice(3) %}
            <div class="list-group-item">
                <h6>
                {{ op['nombre']|default(op['usuario']|default(op['user']|default('Usuario'))) | e }}
                <small class="text-muted">
                    ({{ op['fecha'] is defined ? op['fecha'].toDateTime().format('d/m/Y') : '' }})
                </small>
                </h6>
                <p class="mb-1">
                <img src="{{ asset('img/promedio2.png') }}" alt="Valoraciones" style="height:26px;vertical-align:middle;margin-right:7px;">
                Valoración: <strong>{{ op['puntuacion']|default('-') }}/10</strong><br>
                {{ op['comentario']|default('')|e }}
                </p>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-2">
            <button class="btn btn-info btn-sm d-inline-flex align-items-center px-3 shadow" id="ver-todas-opiniones" onclick="
            document.getElementById('opiniones-extra').style.display='block';
            this.style.display='none';
            ">
            <svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' fill='currentColor' class='bi bi-chat-dots me-2' viewBox='0 0 16 16'>
                <path d='M2 2a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h2.586l2.707 2.707A1 1 0 0 0 9 15V13h5a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H2zm0 1h12a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H9v2.586L6.293 12H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z'/>
                <path d='M5 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z'/>
            </svg>
            Ver todas las opiniones
            </button>
        </div>
        {% endif %}
    </div>
    </div>
</div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}